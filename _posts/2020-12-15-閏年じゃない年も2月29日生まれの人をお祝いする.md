---
title: "é–å¹´ã˜ã‚ƒãªã„å¹´ã‚‚2æœˆ29æ—¥ç”Ÿã¾ã‚Œã®äººã‚’ãŠç¥ã„ã™ã‚‹"
categories:
  - blog
tags:
  - PHP
  - Laravel
  - é–å¹´

---

ã“ã‚Œã¯[SOUSEI Technology ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼2020](https://qiita.com/advent-calendar/2020/st) 15æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚  
  
## 2/28ã¨3/1ã©ã¡ã‚‰ã§ç¥ã†ã¹ããªã®ã‹  
  
2/29ç”Ÿã¾ã‚Œã®äººã€é–å¹´ãªã‚‰å½“æ—¥ãŠç¥ã„ã—ã¦ã‚ã’ã‚Œã°ã„ã„ã®ã§ã™ãŒã€é–å¹´ã˜ã‚ƒãªã„ã¨ãã¯ã©ã†ã™ã‚Œã°ã„ã„ã®ï¼Ÿ  
ã‚°ã‚°ã£ã¦ã¿ã¾ã—ãŸã€‚  
  
> ä¾‹å¹´ã«ã¤ã„ã¦ã¯ã€ç”·å¥³å…±ã«ã€Œ2æœˆ28ã«ç¥ã†ã€ã¨ã„ã†å£°ãŒåœ§å€’çš„ã€‚  
> https://cocoloni.jp/love/232234/  
  
> ã‚ã¨ã§ç¥ã‚ã‚Œã‚‹ã¨ã€Œå¿˜ã‚Œã¦ãŸã§ã—ã‚‡ï¼Ÿã€ã£ã¦ãªã‚Šãã†  
> https://teratail.com/questions/145109  
  
ã¨ã„ã†ã“ã¨ã§2/28ã«ãŠç¥ã„ã—ã¾ã™ï¼ðŸŽ‰ðŸŽ‚  
ã‚ã¨ã¯ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã ã‘ï¼  
  
## ä»Šæ—¥ãŒèª•ç”Ÿæ—¥ã®äººã‚’å–å¾—ã™ã‚‹  
  
å½“æ—¥ãŒ2/28ã‹ã¤é–å¹´ã§ãªã„ã¨ãã«ã€è¿½åŠ ã§2/29ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã‚ã’ã‚Œã°OKï¼  
  
```php
$today = Carbon::now()->toDateString();
$users = User::whereDay('birthday', date('d', strtotime($today)))
    ->whereMonth('birthday', date('m', strtotime($today)))
    ->get();
if(date('m-d', strtotime($today)) == '02-28' && !date('L', strtotime($today))) {
    $users->merge(
        User::whereDay('birthday', 29)
        ->whereMonth('birthday', 2)
        ->get();
    );
}
return $users;
```

## ç¯„å›²æŒ‡å®šï¼ˆfromã€œtoï¼‰ã§èª•ç”Ÿæ—¥ã®äººã‚’å–å¾—ã™ã‚‹  
  
ã“ã‚Œã¯æŒ‡å®šã•ã‚ŒãŸæ—¥ä»˜ãŒé–å¹´ã‹ã©ã†ã‹æ°—ã«ã™ã‚‹å¿…è¦ã¯ãªãã€toãŒ2/28ã®ã¨ãã ã‘è€ƒæ…®ã™ã‚Œã°OKï¼  
  
```php
/**
 * æœˆæ—¥ãŒæ—¥ä»˜ç¯„å›²ã«å«ã¾ã‚Œã‚‹ã‚¹ã‚³ãƒ¼ãƒ—
 *
 * @param Builder $query ã‚¯ã‚¨ãƒª
 * @param string $column å¯¾è±¡ã‚«ãƒ©ãƒ 
 * @param Carbon $from é–‹å§‹æ—¥
 * @param Carbon $to çµ‚äº†æ—¥
 * @return Builder
 */
private function scopeWhereBetweenMonthAndDays($query, $column, $from, $to)
{
    // fromã¨toã®å·®ãŒ1å¹´ä»¥ä¸Šã‚ã‚‹ã¨ãã¯ã™ã¹ã¦ã®æ—¥ãŒå¯¾è±¡ã«ãªã‚‹ã®ã§ã‚¯ã‚¨ãƒªè¿½åŠ ä¸è¦ï¼ˆå…¨ãƒ‡ãƒ¼ã‚¿å–å¾—ã™ã‚‹ï¼‰
    if (!$to->diffInYears($from)) {
        $from_without_year = $from->format('m-d');
        // é–å¹´å¯¾å¿œã€‚2/28ãŒæŒ‡å®šã•ã‚ŒãŸå ´åˆã¯2/29ã¨ã—ã¦ã€2/29ã®ãƒ‡ãƒ¼ã‚¿ã‚‚å–å¾—å¯¾è±¡ã¨ã™ã‚‹
        $to_without_year = $to->format('m-d') == '02-28' ? '02-29' : $to->format('m-d');

        if ($from->year == $to->year) {
            $query = $query->whereRaw('DATE_FORMAT(' . $column . ',"%m-%d") >= "' . $from_without_year . '"')
                ->whereRaw('DATE_FORMAT(' . $column . ',"%m-%d") <= "' . $to_without_year . '"');
        } else {
            $query = $query->where(function ($q1) use ($from_without_year, $to_without_year) {
                $q1->orWhereRaw('DATE_FORMAT(' . $column . ',"%m-%d") >= "' . $from_without_year . '"')
                    ->orWhereRaw('DATE_FORMAT(' . $column . ',"%m-%d") <= "' . $to_without_year . '"');
            });
        }
    }
    return $query;
}
```

## ã•ã„ã”ã«  
  
åƒ•ã®èª•ç”Ÿæ—¥ã¯3/3ã§ã™ï¼  
ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆå¾…ã£ã¦ã¾ã™ï¼  
