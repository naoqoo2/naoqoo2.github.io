---
layout: single
---

<!-- Marp Simple Layout -->
<div class="marp-presentation" style="all: initial; display: block; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
  <style>
    /* 完全隔離されたスタイル - ページ外に影響なし */
    .marp-presentation {
      all: initial;
      display: block !important;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
    }
    
    .marp-presentation *,
    .marp-presentation *:before,
    .marp-presentation *:after {
      all: unset;
      display: revert;
      box-sizing: border-box;
    }
    
    .marp-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: #f8f9fa;
      border: 1px solid #e1e5e9;
      border-radius: 6px;
      margin-bottom: 20px;
    }
    
    .marp-nav button {
      background: #0969da;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .marp-nav button:disabled {
      background: #6c757d;
      cursor: not-allowed;
      opacity: 0.6;
    }
    
    .marp-counter {
      font-weight: 600;
      font-size: 14px;
      color: #24292e;
    }
    
    .marp-slide {
      background: white;
      border: 1px solid #d0d7de;
      border-radius: 8px;
      padding: 48px;
      width: 960px;
      height: 540px;
      aspect-ratio: 16/9;
      display: none;
      overflow: auto;
      font-size: 20px !important;
      line-height: 1.6 !important;
      color: #24292f !important;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
      font-weight: normal !important;
    }
    
    /* layout: singleで表示されるPermalink非表示 - スライド内では意味がない */
    .marp-slide .post-meta,
    .marp-slide .page__meta,
    .marp-slide .page__date,
    .marp-slide .page__taxonomy,
    .marp-slide .page-share,
    .marp-slide .btn,
    .marp-slide .header-link {
      display: none !important;
    }
    
    .marp-slide.active {
      display: block;
    }
    
    .marp-slide h1 {
      font-size: 40px !important;
      margin: 0 0 32px 0 !important;
      font-weight: 700 !important;
      color: #24292f !important;
      line-height: 1.2 !important;
    }
    
    .marp-slide h2 {
      font-size: 32px !important;
      margin: 32px 0 24px 0 !important;
      font-weight: 600 !important;
      color: #24292f !important;
      line-height: 1.3 !important;
    }
    
    .marp-slide h3 {
      font-size: 26px !important;
      margin: 24px 0 16px 0 !important;
      font-weight: 600 !important;
      color: #24292f !important;
      line-height: 1.4 !important;
    }
    
    .marp-slide ul, .marp-slide ol {
      margin: 16px 0 !important;
      padding-left: 32px !important;
      list-style-type: disc !important;
    }
    
    .marp-slide li {
      margin: 8px 0 !important;
      line-height: 1.5 !important;
      display: list-item !important;
    }
    
    .marp-slide strong {
      font-weight: bold !important;
      color: #24292f !important;
    }
    
    .marp-slide p {
      margin: 16px 0 !important;
      line-height: 1.6 !important;
      font-family: inherit !important;
    }
    
    .marp-slide * {
      font-family: inherit !important;
      font-weight: normal !important;
    }
    
    /* 外部スタイルの完全リセット */
    .marp-slide, .marp-slide * {
      box-sizing: border-box !important;
      max-width: none !important;
      margin-left: 0 !important;
      margin-right: 0 !important;
    }
    
    /* テキストサイズの再確認 */
    .marp-slide p, .marp-slide li, .marp-slide span {
      font-size: 20px !important;
    }
  </style>
  
  <!-- ナビゲーション -->
  <div class="marp-nav">
    <button onclick="prevSlide()" id="prev-btn">← 前へ</button>
    <span class="marp-counter" id="slide-counter">1 / 1</span>
    <button onclick="nextSlide()" id="next-btn">次へ →</button>
  </div>
  
  <!-- スライド表示エリア -->
  <div id="slides-container"></div>
  
  <!-- 元コンテンツ（非表示） -->
  <div id="raw-content" style="display: none;">{{ content }}</div>
</div>

<script>
let currentSlide = 0;
let totalSlides = 0;

// ページ読み込み時に初期化
document.addEventListener('DOMContentLoaded', function() {
  initializeSlides();
});

function initializeSlides() {
  const rawContentElement = document.getElementById('raw-content');
  
  try {
    // HTMLコンテンツを取得
    let htmlContent = rawContentElement.innerHTML;
    
    // styleタグを除去
    htmlContent = htmlContent.replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '');
    
    // HTMLをマークダウン風テキストに変換
    let textContent = htmlContent
      .replace(/<hr\s*\/?>/gi, '\n---\n')
      .replace(/<\/p>\s*<p>/gi, '\n\n')
      .replace(/<p>/gi, '')
      .replace(/<\/p>/gi, '\n')
      .replace(/<h([1-6])>/gi, (match, level) => '#'.repeat(parseInt(level)) + ' ')
      .replace(/<\/h[1-6]>/gi, '\n\n')
      .replace(/<strong>/gi, '**')
      .replace(/<\/strong>/gi, '**')
      .replace(/<li>/gi, '- ')
      .replace(/<\/li>/gi, '\n')
      .replace(/<\/?ul>/gi, '')
      .replace(/<\/?ol>/gi, '')
      .replace(/\s*\n\s*\n\s*/g, '\n\n')
      .trim();
    
    // スライドに分割
    let slides = textContent.split(/\n\s*---\s*\n/);
    slides = slides.filter(slide => slide.trim().length >= 5);
    
    totalSlides = slides.length;
    
    if (totalSlides === 0) {
      document.getElementById('slides-container').innerHTML = 
        '<div class="marp-slide active"><h1>スライドがありません</h1><p>コンテンツを確認してください。</p></div>';
      totalSlides = 1;
    } else {
      generateSlides(slides);
    }
    
    // URL hashからスライド番号を取得
    const hash = window.location.hash;
    if (hash && hash.startsWith('#slide-')) {
      const slideNumber = parseInt(hash.replace('#slide-', ''));
      if (slideNumber >= 1 && slideNumber <= totalSlides) {
        currentSlide = slideNumber - 1; // 0ベースのインデックスに変換
        console.log('URL hashから開始スライド:', slideNumber);
      }
    }
    
    showCurrentSlide();
    
  } catch (error) {
    console.error('スライド初期化エラー:', error);
    document.getElementById('slides-container').innerHTML = 
      '<div class="marp-slide active"><h1>エラー</h1><p>スライドの読み込みに失敗しました。</p></div>';
    totalSlides = 1;
    showCurrentSlide();
  }
}

function generateSlides(slides) {
  const container = document.getElementById('slides-container');
  container.innerHTML = '';
  
  slides.forEach((slide, index) => {
    const slideDiv = document.createElement('div');
    slideDiv.className = 'marp-slide';
    slideDiv.id = 'slide-' + index;
    
    // デバッグ用ログ
    console.log('Processing slide:', index);
    console.log('Raw slide content:', slide.trim());
    
    // Permalink要素の検出
    if (slide.includes('permalink') || slide.includes('post-meta') || slide.includes('page__meta')) {
      console.warn('Permalink要素が検出されました:', slide);
    }
    
    // マークダウンをHTMLに変換（段落単位で処理）
    let lines = slide.trim().split('\n');
    let html = '';
    let inList = false;
    
    for (let i = 0; i < lines.length; i++) {
      let line = lines[i].trim();
      
      // 空行の処理
      if (line === '') {
        if (inList) {
          html += '</ul>';
          inList = false;
        }
        html += '</p><p>';
        continue;
      }
      
      // ヘッダーの処理
      if (line.match(/^###\s+(.+)$/)) {
        if (inList) { html += '</ul>'; inList = false; }
        html += '<h3>' + line.replace(/^###\s+/, '') + '</h3>';
      } else if (line.match(/^##\s+(.+)$/)) {
        if (inList) { html += '</ul>'; inList = false; }
        html += '<h2>' + line.replace(/^##\s+/, '') + '</h2>';
      } else if (line.match(/^#\s+(.+)$/)) {
        if (inList) { html += '</ul>'; inList = false; }
        html += '<h1>' + line.replace(/^#\s+/, '') + '</h1>';
      } 
      // リストの処理
      else if (line.match(/^-\s+(.+)$/)) {
        if (!inList) {
          html += '<ul>';
          inList = true;
        }
        let listItem = line.replace(/^-\s+/, '');
        // 太字処理
        listItem = listItem.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
        html += '<li>' + listItem + '</li>';
      } 
      // 通常の段落
      else {
        if (inList) { html += '</ul>'; inList = false; }
        // 太字処理
        line = line.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
        html += line + ' ';
      }
    }
    
    // 最後にリストが開いていた場合は閉じる
    if (inList) {
      html += '</ul>';
    }
    
    // 段落タグで包む（空の段落タグを除去）
    html = '<p>' + html + '</p>';
    html = html.replace(/<p><\/p>/g, '').replace(/<p>\s*<\/p>/g, '');
    
    console.log('Processed HTML:', html);
    
    slideDiv.innerHTML = html;
    container.appendChild(slideDiv);
  });
}

function showCurrentSlide() {
  // 全スライドを非表示
  document.querySelectorAll('.marp-slide').forEach(slide => slide.classList.remove('active'));
  
  // 現在のスライドを表示
  const currentSlideElement = document.getElementById('slide-' + currentSlide);
  if (currentSlideElement) {
    currentSlideElement.classList.add('active');
  }
  
  // カウンター更新
  document.getElementById('slide-counter').textContent = (currentSlide + 1) + ' / ' + totalSlides;
  
  // ボタン状態更新
  document.getElementById('prev-btn').disabled = (currentSlide === 0);
  document.getElementById('next-btn').disabled = (currentSlide === totalSlides - 1);
  
  // URL hashを更新（ヒストリーには追加しない）
  const newHash = '#slide-' + (currentSlide + 1);
  if (window.location.hash !== newHash) {
    window.location.hash = newHash;
    console.log('URL hashを更新:', newHash);
  }
}

function nextSlide() {
  if (currentSlide < totalSlides - 1) {
    currentSlide++;
    showCurrentSlide();
  }
}

function prevSlide() {
  if (currentSlide > 0) {
    currentSlide--;
    showCurrentSlide();
  }
}

// キーボードナビゲーション
document.addEventListener('keydown', function(event) {
  if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') return;
  
  switch (event.key) {
    case 'ArrowLeft':
    case 'ArrowUp':
      prevSlide();
      event.preventDefault();
      break;
    case 'ArrowRight':
    case 'ArrowDown':
    case ' ':
      nextSlide();
      event.preventDefault();
      break;
  }
});
</script>