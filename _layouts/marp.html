---
layout: single
---

<!--
Marp Layout for Jekyll
======================
マークダウンファイルからプレゼンテーションスライドを生成するJekyll用レイアウト

Features:
- 3つの表示モード: スライド、記事、マークダウン
- レスポンシブデザイン（デスクトップ、タブレット、スマートフォン対応）
- キーボードナビゲーション（矢印キー、p/n、数字キー、Home/End）
- アクセシビリティ対応（ARIA属性、スクリーンリーダー対応）
- セキュリティ対策（XSSサニタイゼーション、入力値検証）
- パフォーマンス最適化（コンテンツキャッシュ、DOM操作最適化）

Security:
- HTMLサニタイゼーション実装済み
- XSS攻撃対策済み
- DoS攻撃対策済み（コンテンツサイズ制限）

Accessibility:
- WCAG準拠のARIA属性
- キーボード完全対応
- スクリーンリーダー対応
- ハイコントラストモード対応
-->

<div class="marp-container">
  <!-- marpコンテナ内のスタイル分離 -->
  <style>
    .marp-container {
      isolation: isolate;
      contain: style;
    }
    /* ページ外の要素（Share onボタンなど）への干渉を防ぐ */
    .marp-container ~ * {
      all: revert !important;
    }
  </style>
  

  <!-- スライド表示用 -->
  <div id="slide-view" class="marp-slide-view" role="main" aria-label="プレゼンテーションスライド">
    <!-- スライドナビゲーション -->
    <nav class="slide-navigation" role="navigation" aria-label="スライドナビゲーション">
      <button id="prev-btn" class="nav-btn" onclick="prevSlide()" disabled aria-label="前のスライドへ" title="前のスライド（矢印キー左）">← 前へ</button>
      <span id="slide-counter" class="slide-counter" role="status" aria-live="polite" aria-label="スライド番号">1 / 1</span>
      <button id="next-btn" class="nav-btn" onclick="nextSlide()" aria-label="次のスライドへ" title="次のスライド（矢印キー右）">次へ →</button>
    </nav>
    
    <!-- スライドコンテナ -->
    <div id="slides-container" class="slides-container" role="presentation">
      <!-- JavaScriptで動的に生成 -->
    </div>
  </div>


  <!-- 元のコンテンツ（非表示） -->
  <div id="raw-content" style="display: none;">
{{ content }}
  </div>
</div>

<style>
.marp-container {
  max-width: 100%;
  margin: 0 auto;
}


.marp-slide-view {
  display: block;
}

.slide-navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 8px;
  border: 1px solid #e1e5e9;
  flex-wrap: wrap;
  gap: 10px;
}

.nav-btn {
  background: #0969da;
  border: none;
  border-radius: 6px;
  color: white;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  padding: 8px 16px;
  transition: background-color 0.2s;
}

.nav-btn:hover:not(:disabled) {
  background: #0860ca;
}

.nav-btn:disabled {
  background: #6c757d;
  cursor: not-allowed;
  opacity: 0.6;
}

.slide-counter {
  font-size: 16px;
  font-weight: 600;
  color: #24292e;
}

.slides-container {
  position: relative;
  min-height: 450px;
}

.marp-slide {
  background: white;
  border: 1px solid #e1e5e9;
  border-radius: 8px;
  padding: 40px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  min-height: 400px;
  font-size: 1.1em;
  display: none;
}

.marp-slide.active {
  display: block;
}

.marp-slide h1 {
  color: #2c5282;
  border-bottom: 3px solid #2c5282;
  padding-bottom: 10px;
  margin-bottom: 30px;
  font-size: 2em;
}

.marp-slide h2 {
  color: #2d3748;
  margin: 25px 0 15px 0;
  font-size: 1.5em;
}

.marp-slide h3 {
  color: #4a5568;
  margin: 20px 0 10px 0;
  font-size: 1.3em;
}

.marp-slide ul {
  margin: 15px 0;
  padding-left: 25px;
}

.marp-slide li {
  margin: 8px 0;
  line-height: 1.6;
}

.marp-slide strong {
  color: #e53e3e;
  font-weight: 600;
}


/* レスポンシブ対応（改善版） */

/* タブレットサイズ (769px - 1024px) */
@media (min-width: 769px) and (max-width: 1024px) {
  .marp-slide {
    padding: 30px;
    margin: 15px 0;
    min-height: 380px;
    font-size: 1.05em;
  }
  
  .marp-slide h1 {
    font-size: 1.8em;
  }
  
  .marp-slide h2 {
    font-size: 1.4em;
  }
  
  
  .slide-navigation {
    margin-bottom: 15px;
  }
}

/* スマートフォンサイズ (768px以下) */
@media (max-width: 768px) {
  .marp-container {
    padding: 0 10px;
  }
  
  .marp-slide {
    padding: 15px;
    margin: 10px 0;
    min-height: 250px;
    font-size: 0.95em;
  }
  
  .marp-slide h1 {
    font-size: 1.5em;
    margin-bottom: 20px;
  }
  
  .marp-slide h2 {
    font-size: 1.25em;
    margin: 20px 0 12px 0;
  }
  
  .marp-slide h3 {
    font-size: 1.1em;
    margin: 15px 0 8px 0;
  }
  
  .marp-controls {
    margin-bottom: 12px;
    padding-bottom: 12px;
  }
  
  
  .slide-navigation {
    flex-direction: column;
    gap: 10px;
    padding: 12px;
    margin-bottom: 12px;
  }
  
  .nav-btn {
    font-size: 13px;
    padding: 6px 12px;
    width: 100%;
    max-width: 120px;
  }
  
  .slide-counter {
    font-size: 14px;
    order: -1;
  }
  
}

/* 小さなスマートフォン (480px以下) */
@media (max-width: 480px) {
  .marp-slide {
    padding: 10px;
    margin: 8px 0;
    min-height: 200px;
    font-size: 0.9em;
  }
  
  .marp-slide h1 {
    font-size: 1.3em;
    margin-bottom: 15px;
  }
  
  .marp-slide h2 {
    font-size: 1.15em;
  }
  
  .marp-slide li {
    margin: 6px 0;
  }
  
  
  .nav-btn {
    font-size: 12px;
    padding: 5px 10px;
  }
  
  .slide-counter {
    font-size: 13px;
  }
}

/* フォーカススタイルの改善（アクセシビリティ） */
.nav-btn:focus {
  outline: 2px solid #0969da;
  outline-offset: 2px;
}

.marp-slide:focus {
  outline: 3px solid #0969da;
  outline-offset: 2px;
}

/* ハイコントラストモード対応 */
@media (prefers-contrast: high) {
  .marp-slide {
    border: 2px solid #000;
  }
  
  .nav-btn {
    background: #000;
    border: 1px solid #000;
  }
}

/* モーションを無効にしたユーザー対応 */
@media (prefers-reduced-motion: reduce) {
  .marp-slide {
    transition: none;
  }
  
  .nav-btn {
    transition: none;
  }
}
</style>

<script>
let currentSlide = 0;
let totalSlides = 0;

// パフォーマンス最適化用のキャッシュ
let cachedSlides = null;
let lastRawContent = null;

// HTMLサニタイゼーション関数
function sanitizeHTML(html) {
  // 許可するタグのホワイトリスト
  const allowedTags = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'br', 'strong', 'em', 'ul', 'ol', 'li', 'code', 'pre', 'blockquote'];
  const allowedAttributes = ['class', 'id'];
  
  // 一時的なDOM要素を作成してパース
  const temp = document.createElement('div');
  temp.innerHTML = html;
  
  // 再帰的にノードをサニタイズ
  function sanitizeNode(node) {
    if (node.nodeType === Node.TEXT_NODE) {
      return node;
    }
    
    if (node.nodeType === Node.ELEMENT_NODE) {
      const tagName = node.tagName.toLowerCase();
      
      // 許可されていないタグは削除
      if (!allowedTags.includes(tagName)) {
        const fragment = document.createDocumentFragment();
        while (node.firstChild) {
          fragment.appendChild(sanitizeNode(node.firstChild));
        }
        return fragment;
      }
      
      // 許可されていない属性を削除
      const attributes = Array.from(node.attributes);
      attributes.forEach(attr => {
        if (!allowedAttributes.includes(attr.name.toLowerCase())) {
          node.removeAttribute(attr.name);
        }
      });
      
      // 子ノードを再帰的にサニタイズ
      const children = Array.from(node.childNodes);
      children.forEach(child => {
        const sanitized = sanitizeNode(child);
        if (sanitized !== child) {
          node.replaceChild(sanitized, child);
        }
      });
    }
    
    return node;
  }
  
  // 全ノードをサニタイズ
  const children = Array.from(temp.childNodes);
  children.forEach(child => sanitizeNode(child));
  
  return temp.innerHTML;
}

// ページ読み込み時にコンテンツを処理
document.addEventListener('DOMContentLoaded', function() {
  initializeMarpContent();
});

function initializeMarpContent() {
  const rawContent = document.getElementById('raw-content').textContent;
  
  try {
    // スタイルタグとCSSコメントを安全に削除
    let cleanContent = rawContent;
    
    // 入力長制限（異常に大きなファイル対策）
    if (cleanContent.length > 500000) {
      // 本番環境ではエラーログのみ出力
      if (typeof window !== 'undefined' && window.location.hostname === 'localhost') {
        console.warn('Marp: コンテンツが大きすぎるため、切り詰められました');
      }
      cleanContent = cleanContent.substring(0, 500000);
    }
    
    // CSSコメントとスタイルブロックを安全に削除
    cleanContent = cleanContent.replace(/<!--\s*style\s*-->/gi, '');
    cleanContent = cleanContent.replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '');
    
    // CSSルールをより安全に削除（行頭のみ）
    cleanContent = cleanContent.replace(/^\s*section\s*\{[^}]*\}\s*$/gm, '');
    cleanContent = cleanContent.replace(/^\s*[a-zA-Z][\w\-\.#:\s]*\s*\{[^}]*\}\s*$/gm, '');
    
    // 行を安全に処理（空の行を保持）
    const lines = cleanContent.split('\n');
    const trimmedLines = lines.map(line => {
      // タブとスペースのみをtrimし、内容は保持
      return line.replace(/^[\t\s]+|[\t\s]+$/g, '');
    });
    cleanContent = trimmedLines.join('\n');
    
    // 連続する空行を整理（最大3行まで）
    cleanContent = cleanContent.replace(/\n{4,}/g, '\n\n\n');
    
    // スライドに分割（より安全な正規表現）
    let slides = cleanContent.split(/\n\s*-{3,}\s*\n/);
    
    // YAML Front Matterを検出して除去
    slides = slides.filter((slide, index) => {
      const trimmed = slide.trim();
      
      // 空のスライドを除去
      if (trimmed === '') {
        return false;
      }
      
      // YAML Front Matterの特徴を検出（最初のスライドのみチェック）
      if (index === 0) {
        const yamlPattern = /^(?:title:|layout:|categories:|tags:|marp:|paginate:|date:|author:)/m;
        if (yamlPattern.test(trimmed)) {
          return false;
        }
      }
      
      // コンテンツの最小長チェック（空のスライド防止）
      return trimmed.length >= 3;
    });
  
    totalSlides = slides.length;
    
    // スライドがない場合のエラーハンドリング
    if (totalSlides === 0) {
      // ユーザーにメッセージを表示（エラーログは不要）
      document.getElementById('slides-container').innerHTML = '<div class="marp-slide active"><h2>スライドが見つかりません</h2><p>有効なコンテンツを確認してください。</p></div>';
      totalSlides = 1;
      showCurrentSlide();
      return;
    }
    
    // スライド数制限（パフォーマンス対策）
    if (totalSlides > 200) {
      slides = slides.slice(0, 200);
      totalSlides = 200;
      // 開発環境でのみ警告を表示
      if (typeof window !== 'undefined' && window.location.hostname === 'localhost') {
        console.warn('Marp: スライド数が多すぎるため、200枚に制限しました');
      }
    }
    
    // 開発環境でのみログ出力
    if (typeof window !== 'undefined' && window.location.hostname === 'localhost') {
      console.log('Marp: ' + totalSlides + '枚のスライドを読み込みました');
    }
    
    // キャッシュを更新
    cachedSlides = slides;
    lastRawContent = rawContent;
    
    // スライド表示用のHTMLを生成
    generateSlideView(slides);
    
    // 初期表示設定
    showCurrentSlide();
    
  } catch (error) {
    console.error('Marp: コンテンツの初期化中にエラーが発生しました:', error);
    
    // エラー時のフォールバック表示
    document.getElementById('slides-container').innerHTML = 
      '<div class="marp-slide active"><h2>エラーが発生しました</h2><p>コンテンツの読み込みに失敗しました。ファイルの形式を確認してください。</p></div>';
    totalSlides = 1;
    showCurrentSlide();
  }
}

function generateSlideView(slides) {
  const slidesContainer = document.getElementById('slides-container');
  if (!slidesContainer) {
    console.error('Marp: slides-container要素が見つかりません');
    return;
  }
  
  slidesContainer.innerHTML = '';
  
  if (!Array.isArray(slides) || slides.length === 0) {
    console.warn('Marp: 有効なスライドデータがありません');
    return;
  }
  
  slides.forEach(function(slide, index) {
    const trimmedSlide = slide ? slide.trim() : '';
    
    if (trimmedSlide) {
      try {
        const slideDiv = document.createElement('div');
        slideDiv.className = 'marp-slide';
        slideDiv.id = 'slide-' + index;
        slideDiv.setAttribute('role', 'tabpanel');
        slideDiv.setAttribute('aria-label', 'スライド ' + (index + 1));
      
      // Markdownの基本的な変換を手動で行う
      let html = slide.trim();
      
      // 入力長制限（DoS攻撃対策）
      if (html.length > 50000) {
        html = html.substring(0, 50000) + '... [コンテンツが切り詰められました]';
      }
      
      // 見出しの変換（より安全な正規表現）
      html = html.replace(/^### (.{1,200})$/gm, '<h3>$1</h3>');
      html = html.replace(/^## (.{1,200})$/gm, '<h2>$1</h2>');
      html = html.replace(/^# (.{1,200})$/gm, '<h1>$1</h1>');
      
      // 太字の変換（入れ子制限）
      html = html.replace(/\*\*([^*]{1,500})\*\*/g, '<strong>$1</strong>');
      
      // リストの変換（改善版）
      const lines = html.split('\n');
      let processedLines = [];
      let inList = false;
      
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const listMatch = line.match(/^(\s*)-\s+(.*)$/);
        
        if (listMatch) {
          const indent = listMatch[1].length;
          const content = listMatch[2];
          
          if (!inList) {
            processedLines.push('<ul>');
            inList = true;
          }
          
          const marginLeft = indent > 0 ? ` style="margin-left: ${indent * 10}px;"` : '';
          processedLines.push(`<li${marginLeft}>${content}</li>`);
        } else {
          if (inList) {
            processedLines.push('</ul>');
            inList = false;
          }
          processedLines.push(line);
        }
      }
      
      if (inList) {
        processedLines.push('</ul>');
      }
      
      html = processedLines.join('\n');
      
      // 改行を<br>に変換（リスト以外）
      html = html.replace(/\n(?![\s]*<[\/]?(ul|li))/g, '<br>');
      
        // HTMLをサニタイズしてから設定
        const sanitizedHTML = sanitizeHTML(html);
        slideDiv.innerHTML = sanitizedHTML;
        slidesContainer.appendChild(slideDiv);
        
      } catch (error) {
        console.error(`Marp: スライド ${index} の生成中にエラー:`, error);
        
        // エラー時のフォールバックスライド
        const errorSlide = document.createElement('div');
        errorSlide.className = 'marp-slide';
        errorSlide.id = 'slide-' + index;
        errorSlide.innerHTML = '<h2>スライド読み込みエラー</h2><p>このスライドの読み込みに失敗しました。</p>';
        slidesContainer.appendChild(errorSlide);
      }
    }
  });
}


// キャッシュからの高速表示関数
function generateSlideViewFromCache() {
  if (!cachedSlides) return;
  
  const slidesContainer = document.getElementById('slides-container');
  if (!slidesContainer) return;
  
  // キャッシュされたスライドで再生成
  generateSlideView(cachedSlides);
}


// スライドナビゲーション機能
function showCurrentSlide() {
  try {
    // スライド番号のバリデーション
    if (currentSlide < 0) {
      currentSlide = 0;
    }
    if (currentSlide >= totalSlides) {
      currentSlide = totalSlides - 1;
    }
    
    // 全てのスライドを非表示にする
    const slides = document.querySelectorAll('.marp-slide');
    slides.forEach(slide => slide.classList.remove('active'));
    
    // 現在のスライドを表示
    const currentSlideElement = document.getElementById('slide-' + currentSlide);
    if (currentSlideElement) {
      currentSlideElement.classList.add('active');
      currentSlideElement.focus(); // アクセシビリティ改善
    }
    
    // カウンターを更新
    const slideCounter = document.getElementById('slide-counter');
    if (slideCounter) {
      slideCounter.textContent = (currentSlide + 1) + ' / ' + totalSlides;
      slideCounter.setAttribute('aria-live', 'polite'); // スクリーンリーダー対応
    }
    
    // ボタンの状態を更新
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    
    if (prevBtn) {
      prevBtn.disabled = (currentSlide === 0);
      prevBtn.setAttribute('aria-label', currentSlide === 0 ? '前のスライド（先頭）' : '前のスライドへ');
    }
    
    if (nextBtn) {
      nextBtn.disabled = (currentSlide === totalSlides - 1);
      nextBtn.setAttribute('aria-label', currentSlide === totalSlides - 1 ? '次のスライド（末尾）' : '次のスライドへ');
    }
    
  } catch (error) {
    console.error('Marp: スライド表示中にエラー:', error);
  }
}

function nextSlide() {
  if (currentSlide < totalSlides - 1) {
    currentSlide++;
    showCurrentSlide();
  }
}

function prevSlide() {
  if (currentSlide > 0) {
    currentSlide--;
    showCurrentSlide();
  }
}

// キーボードナビゲーション（改善版）
document.addEventListener('keydown', function(event) {
  // スライドビューが存在する場合のみキーボードナビゲーションを有効に
  const slideView = document.getElementById('slide-view');
  if (!slideView) {
    return;
  }
  
  // フォームエレメントにフォーカスがある場合はスキップ
  if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA' || event.target.tagName === 'SELECT') {
    return;
  }
  
  let handled = false;
  
  switch (event.key) {
    case 'ArrowLeft':
    case 'ArrowUp':
    case 'PageUp':
    case 'p': // pキーでprevious
      prevSlide();
      handled = true;
      break;
      
    case 'ArrowRight':
    case 'ArrowDown':
    case 'PageDown':
    case 'n': // nキーでnext
    case ' ': // スペースキー
      nextSlide();
      handled = true;
      break;
      
    case 'Home':
      currentSlide = 0;
      showCurrentSlide();
      handled = true;
      break;
      
    case 'End':
      currentSlide = totalSlides - 1;
      showCurrentSlide();
      handled = true;
      break;
      
    // 数字キーでスライドへジャンプ（1-9）
    case '1':
    case '2':
    case '3':
    case '4':
    case '5':
    case '6':
    case '7':
    case '8':
    case '9':
      const slideNumber = parseInt(event.key) - 1;
      if (slideNumber < totalSlides) {
        currentSlide = slideNumber;
        showCurrentSlide();
        handled = true;
      }
      break;
  }
  
  if (handled) {
    event.preventDefault();
    event.stopPropagation();
  }
});




</script>